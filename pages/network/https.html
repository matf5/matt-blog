<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>背景 | matt的前端之路</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/matt-blog/cainiao.jpg">
    <meta name="description" content="matt的前端之路">
    
    <link rel="preload" href="/matt-blog/assets/css/0.styles.67df34d8.css" as="style"><link rel="preload" href="/matt-blog/assets/js/app.2eaa7660.js" as="script"><link rel="preload" href="/matt-blog/assets/js/2.778bb4ad.js" as="script"><link rel="preload" href="/matt-blog/assets/js/1.f8bb34da.js" as="script"><link rel="preload" href="/matt-blog/assets/js/25.2773990a.js" as="script"><link rel="prefetch" href="/matt-blog/assets/js/10.fde088a2.js"><link rel="prefetch" href="/matt-blog/assets/js/11.c62b6b34.js"><link rel="prefetch" href="/matt-blog/assets/js/12.27d4f152.js"><link rel="prefetch" href="/matt-blog/assets/js/13.3f3f6a36.js"><link rel="prefetch" href="/matt-blog/assets/js/14.eb7a3d07.js"><link rel="prefetch" href="/matt-blog/assets/js/15.114dfd5c.js"><link rel="prefetch" href="/matt-blog/assets/js/16.85253907.js"><link rel="prefetch" href="/matt-blog/assets/js/17.c2838453.js"><link rel="prefetch" href="/matt-blog/assets/js/18.3256f17f.js"><link rel="prefetch" href="/matt-blog/assets/js/19.d8afd0ae.js"><link rel="prefetch" href="/matt-blog/assets/js/20.0d880388.js"><link rel="prefetch" href="/matt-blog/assets/js/21.33b300c9.js"><link rel="prefetch" href="/matt-blog/assets/js/22.b7c97fbe.js"><link rel="prefetch" href="/matt-blog/assets/js/23.4db98f57.js"><link rel="prefetch" href="/matt-blog/assets/js/24.f1640500.js"><link rel="prefetch" href="/matt-blog/assets/js/26.3f9a83a0.js"><link rel="prefetch" href="/matt-blog/assets/js/27.9a298227.js"><link rel="prefetch" href="/matt-blog/assets/js/28.e2a66828.js"><link rel="prefetch" href="/matt-blog/assets/js/29.97d11acd.js"><link rel="prefetch" href="/matt-blog/assets/js/3.af33e5d6.js"><link rel="prefetch" href="/matt-blog/assets/js/30.22bee9f6.js"><link rel="prefetch" href="/matt-blog/assets/js/31.1d76566f.js"><link rel="prefetch" href="/matt-blog/assets/js/32.4a0440ac.js"><link rel="prefetch" href="/matt-blog/assets/js/33.37b462a8.js"><link rel="prefetch" href="/matt-blog/assets/js/34.88ebc733.js"><link rel="prefetch" href="/matt-blog/assets/js/35.eff53b64.js"><link rel="prefetch" href="/matt-blog/assets/js/36.82f9ebe4.js"><link rel="prefetch" href="/matt-blog/assets/js/37.159089ca.js"><link rel="prefetch" href="/matt-blog/assets/js/38.7b02d561.js"><link rel="prefetch" href="/matt-blog/assets/js/39.aad63f87.js"><link rel="prefetch" href="/matt-blog/assets/js/4.45665f8a.js"><link rel="prefetch" href="/matt-blog/assets/js/40.b7168191.js"><link rel="prefetch" href="/matt-blog/assets/js/41.0df1c711.js"><link rel="prefetch" href="/matt-blog/assets/js/42.edc6c793.js"><link rel="prefetch" href="/matt-blog/assets/js/43.10b4130b.js"><link rel="prefetch" href="/matt-blog/assets/js/44.301e1f95.js"><link rel="prefetch" href="/matt-blog/assets/js/45.b2583536.js"><link rel="prefetch" href="/matt-blog/assets/js/46.53181746.js"><link rel="prefetch" href="/matt-blog/assets/js/47.fdee3dd3.js"><link rel="prefetch" href="/matt-blog/assets/js/48.69af6e5b.js"><link rel="prefetch" href="/matt-blog/assets/js/49.2974f0ce.js"><link rel="prefetch" href="/matt-blog/assets/js/5.7098d77a.js"><link rel="prefetch" href="/matt-blog/assets/js/50.f197b11d.js"><link rel="prefetch" href="/matt-blog/assets/js/51.129ab8d5.js"><link rel="prefetch" href="/matt-blog/assets/js/52.39fbb785.js"><link rel="prefetch" href="/matt-blog/assets/js/53.497a8b17.js"><link rel="prefetch" href="/matt-blog/assets/js/54.6154a915.js"><link rel="prefetch" href="/matt-blog/assets/js/55.783c32bb.js"><link rel="prefetch" href="/matt-blog/assets/js/6.0c0a0f39.js"><link rel="prefetch" href="/matt-blog/assets/js/7.6a854e57.js"><link rel="prefetch" href="/matt-blog/assets/js/vendors~docsearch.5e19b665.js">
    <link rel="stylesheet" href="/matt-blog/assets/css/0.styles.67df34d8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/matt-blog/" class="home-link router-link-active"><img src="/matt-blog/cainiao.jpg" alt="matt的前端之路" class="logo"> <span class="site-name can-hide">matt的前端之路</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>hybrid</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>mini-program</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>计算机网络</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/matt-blog/pages/network/https.html" aria-current="page" class="active sidebar-link">浅析https</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>performance</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>项目经验剖析</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>qwik</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react-native</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>rust</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue学习</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpack学习</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>xiaochengxu</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="背景"><a href="#背景" class="header-anchor">#</a> 背景</h3> <p>HTTP为明文传输，起初设计HTTP协议的目的很单纯，就是为了传输超文本文件，那时候也没有太强的加密传输数据需求，所以HTTP一直保持着明文传输数据的特征。正是因为这一特性，传输过程中的每个环节，数据都有可能被篡改或窃取。</p> <h3 id="引入安全层"><a href="#引入安全层" class="header-anchor">#</a> 引入安全层</h3> <p>因此我们需要引入一个加密方案。
从HTTP协议栈层面来看，可以在TCP和HTTP之前插入一个安全层，所有经过安全层的数据都会加密或者解密。</p> <p><img src="https://user-gold-cdn.xitu.io/2020/7/21/17370b66963a32b6?w=1142&amp;h=503&amp;f=png&amp;s=225195" alt=""></p> <p>通常HTTP直接和TCP通信，HTTPS则先和安全层通信，然后安全层再和TCP层通信。可以概括为两个职责：</p> <ul><li>对发起HTTP请求的数据进行加密操作</li> <li>对接收到HTTP的内容进行解密操作</li></ul> <hr> <h3 id="第一版-使用对称加密"><a href="#第一版-使用对称加密" class="header-anchor">#</a> 第一版：使用对称加密</h3> <p>对称加密即指加密和解密用的是相同的密钥
在HTTPS发送该数据之前，浏览器和服务器之间需要协商加密方式和密钥，过程如下</p> <p><img src="https://user-gold-cdn.xitu.io/2020/7/21/17370b9d72c37efb?w=1143&amp;h=551&amp;f=png&amp;s=309717" alt=""></p> <ul><li>浏览器发送它所支持的加密套件列表（加密的方法）和一个随机数client-random</li> <li>服务器从加密套件列表中选取一个加密套件，然后还会生成一个随机数service-random，并将service-random和加密套件列表返回给浏览器</li> <li>浏览器和服务端分别返回确认消息</li> <li>浏览器和服务端利用相同的方法把client-random和service-random混合起来生成一个密钥master secret，然后开始进行数据的加密传输</li></ul> <p><strong>缺点： client-random和seervice-random传输过程是明文的，黑客也可以拿到协商的加密套件和双方的随机数，黑客也可以合成密钥</strong></p> <hr> <h3 id="第二版-使用非对称加密"><a href="#第二版-使用非对称加密" class="header-anchor">#</a> 第二版：使用非对称加密</h3> <p>非对称加密算法有A、B两把密钥，如果你用A密钥来加密，那么只能使用B密钥来解密。
服务器会自己保留私钥，然后将公钥以明文的方法发给浏览器</p> <p><img src="https://user-gold-cdn.xitu.io/2020/7/21/17370c41926a060a?w=1142&amp;h=593&amp;f=png&amp;s=279562" alt=""></p> <ul><li>首先浏览器还是将加密套件列表发给服务器</li> <li>服务器会选择一个加密套件，然后将加密套件和公钥一起发送给浏览器</li> <li>然后就是浏览器和服务器返回确认消息</li> <li>这样浏览器在发送数据时就可以使用该公钥来加密数据，然后服务器使用私钥来解密数据</li></ul> <p><strong>缺点：</strong></p> <ul><li>非对称加密效率太低，影响页面打开速度</li> <li>无法保证服务器发送给浏览器的数据安全，服务端采用私钥加密，只能用公钥解密，黑客也是可以获取到公钥的，从而可以解开数据</li></ul> <hr> <h3 id="第三版-对称加密和非对称加密搭配使用"><a href="#第三版-对称加密和非对称加密搭配使用" class="header-anchor">#</a> 第三版 对称加密和非对称加密搭配使用</h3> <p>基于以上两点缺点，可以选择一个更加完美的方案，在传输数据阶段依然使用对称加密，但是对称加密的密钥我们采用非对称加密来传输</p> <p><img src="https://user-gold-cdn.xitu.io/2020/7/21/173710e3564a5077?w=1142&amp;h=708&amp;f=png&amp;s=421076" alt=""></p> <ul><li>浏览器向服务器发送对称加密套件列表、非对称加密套件列表和随机数client-random</li> <li>服务器保存随机数client-random,选择对称加密和非对称加密的套件，然后生成随机数service-random，向浏览器发送选择的加密套件、serice-random和公钥</li> <li>浏览器保存公钥，利用client-random和service-random计算出来pre-master,然后利用公钥对pre-master加密，并向服务器发送加密后的数据</li> <li>服务器拿出自己的私钥，解密出pre-master数据，并返回确认消息</li> <li>通过这三组随机数生成对称密钥，使用对称加密的方式来传输数据</li></ul> <p>pre-master是经过公钥加密之后传输的，所以黑客无法获取到pre-master，这样黑客就无法生成密钥，也就保证了黑客无法解密传输过程中的数据了</p> <hr> <h3 id="第四版-添加数字证书"><a href="#第四版-添加数字证书" class="header-anchor">#</a> 第四版 添加数字证书</h3> <p>以上方式仍然存在问题，例如访问百度时，黑客有可能通过dns劫持将ip地址替换成黑客的ip地址，这样访问的就是黑客的服务器，黑客可以在自己的服务器上实现公钥和私钥。
那么怎么证明访问的服务器是百度的，就需要使用权威机构（Certiificate Atuthority）颁发的数字证书(Diital Certificate)。</p> <p>对于浏览器来说，数字证书有两个作用：</p> <p>1）向浏览器证明服务器身份</p> <p>2）数字证书中包含了服务器的公钥</p> <p><img src="https://user-gold-cdn.xitu.io/2020/7/21/173711e50c650f08?w=1143&amp;h=818&amp;f=png&amp;s=482527" alt=""></p> <hr> <h3 id="数字证书的申请和验证"><a href="#数字证书的申请和验证" class="header-anchor">#</a> 数字证书的申请和验证</h3> <h4 id="申请数字证书"><a href="#申请数字证书" class="header-anchor">#</a> 申请数字证书</h4> <ul><li>服务器准备一套私钥和公钥，私钥留着自己使用</li> <li>向CA机构提交公钥、公司、站点等信息并等待认证</li> <li>CA通过线上、线下多种渠道来验证网站所提供信息的真实性</li> <li>审核通过，会颁发认证的数字证书，包含网站的公钥、组织信息、CA信息、有效时间、证书序列号，同时包含一个CA生成的数字签名</li></ul> <p>签名：CA使用Hash函数计算网站提交的明文信息，并得出信息摘要，然后再使用他的私钥对信息摘要进行加密，加密后的秘闻就是数字签名</p> <h4 id="浏览器如何验证数字证书"><a href="#浏览器如何验证数字证书" class="header-anchor">#</a> 浏览器如何验证数字证书</h4> <ul><li>读取证书中的明文信息，采用CA签名时相同的hash函数计算并得到信息摘要A，再利用对应CA的公钥解密签名数据，得到信息摘要B; 对比两者如果一致，则说明证书合法</li> <li>这时候验证了CA是谁，但是浏览器不知道该不该信任，就会继续查找给这个CA颁发证书的CA, 再以同样的方式验证它上级CA的可靠性。通常操作系统会内置信任的顶级CA的证书信息，如果这个CA链中没有找到浏览器内置的顶级CA,证书也会被判定非法</li></ul> <p><img src="https://user-gold-cdn.xitu.io/2020/7/21/1737131a9580cc1d?w=1412&amp;h=1362&amp;f=png&amp;s=497294" alt=""></p> <h3 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h3> <p>极客时间《浏览器原理与实践》</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/matt-blog/pages/mini-program/taro.html" class="prev">
        Taro 框架深度解析
      </a></span> <span class="next"><a href="/matt-blog/pages/performance/image-lazy.html">
        图片懒加载
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/matt-blog/assets/js/app.2eaa7660.js" defer></script><script src="/matt-blog/assets/js/2.778bb4ad.js" defer></script><script src="/matt-blog/assets/js/1.f8bb34da.js" defer></script><script src="/matt-blog/assets/js/25.2773990a.js" defer></script>
  </body>
</html>
