(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{307:function(t,s,a){"use strict";a.r(s);var n=a(14),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"深入探索文件上传-从组件设计到断点续传"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#深入探索文件上传-从组件设计到断点续传"}},[t._v("#")]),t._v(" 深入探索文件上传：从组件设计到断点续传")]),t._v(" "),s("p",[t._v("文件上传是 Web 应用中最常见的功能之一，但其背后涉及的知识远比一个 "),s("code",[t._v('<input type="file">')]),t._v(" 标签要复杂得多。一个健壮、高效、用户体验良好的上传功能，需要开发者对前端组件设计、HTTP 协议、大文件处理策略以及云存储服务有深入的理解。")]),t._v(" "),s("p",[t._v("本文将从零开始，探讨如何设计一个现代文件上传组件，并逐步深入到断点续传、分片上传等高级功能的实现，最后结合 AWS S3 的真实世界案例进行分析。")]),t._v(" "),s("h2",{attrs:{id:"part-1-设计一个现代文件上传组件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#part-1-设计一个现代文件上传组件"}},[t._v("#")]),t._v(" Part 1: 设计一个现代文件上传组件")]),t._v(" "),s("p",[t._v("一个优秀的文件上传组件不仅功能要完善，用户体验也至关重要。")]),t._v(" "),s("h3",{attrs:{id:"ui-ux-核心考量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ui-ux-核心考量"}},[t._v("#")]),t._v(" UI/UX 核心考量")]),t._v(" "),s("ol",[s("li",[s("p",[s("strong",[t._v("交互方式")]),t._v(":")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("点击选择")]),t._v(": 提供传统的点击按钮，触发文件选择框。")]),t._v(" "),s("li",[s("strong",[t._v("拖拽上传")]),t._v(": 提供一个可拖拽区域，允许用户将文件直接从桌面拖入，提升效率。")]),t._v(" "),s("li",[s("strong",[t._v("粘贴上传")]),t._v(": (进阶) 监听粘贴事件，允许用户直接粘贴剪贴板中的图片。")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("即时反馈")]),t._v(":")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("文件信息预览")]),t._v(": 文件被选中后，应立即显示文件名、大小、类型，如果是图片，最好能生成本地预览图（使用 "),s("code",[t._v("URL.createObjectURL()")]),t._v("）。")]),t._v(" "),s("li",[s("strong",[t._v("上传进度")]),t._v(": 对每个文件提供独立的实时进度条。")]),t._v(" "),s("li",[s("strong",[t._v("状态清晰")]),t._v(": 明确展示文件的状态：待上传、上传中、成功、失败、暂停。")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("错误处理")]),t._v(":")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("前端校验")]),t._v(": 在上传前对文件大小、类型、数量进行校验，并给出清晰的错误提示。")]),t._v(" "),s("li",[s("strong",[t._v("上传失败")]),t._v(": 上传失败时，提供重试按钮。")])])])]),t._v(" "),s("h3",{attrs:{id:"核心技术实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#核心技术实现"}},[t._v("#")]),t._v(" 核心技术实现")]),t._v(" "),s("div",{staticClass:"language-jsx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-jsx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 一个基础的React组件示例")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" React"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" useState"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" useCallback "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("FileUploader")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("files"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" setFiles"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("useState")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("handleFileChange")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 从event中获取FileList并转为Array")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" selectedFiles "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Array"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("from")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("files"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setFiles")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("selectedFiles"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("handleUpload")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("files"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Please select files first!'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" formData "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FormData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    files"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("file")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      formData"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'files'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" file"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 'files'是与后端约定的字段名")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" response "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/api/upload'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("method")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'POST'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("body")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" formData"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 注意：使用FormData时，浏览器会自动设置正确的Content-Type，无需手动指定")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("response"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ok"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Upload successful!'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Upload failed.'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Error uploading files:'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Upload failed.'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n      ")]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("input")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("file"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("multiple")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("onChange")]),s("span",{pre:!0,attrs:{class:"token script language-javascript"}},[s("span",{pre:!0,attrs:{class:"token script-punctuation punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("handleFileChange"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),s("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n      ")]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("button")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("onClick")]),s("span",{pre:!0,attrs:{class:"token script language-javascript"}},[s("span",{pre:!0,attrs:{class:"token script-punctuation punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("handleUpload"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("Upload")]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("button")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n      ")]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n        ")]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("h4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("Selected Files:")]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("h4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n        ")]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("ul")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n          ")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("files"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("file"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" index")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("li")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token script language-javascript"}},[s("span",{pre:!0,attrs:{class:"token script-punctuation punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("index"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("file"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v(" (")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("Math"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("round")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("file"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("size "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v(" KB)")]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("li")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n        ")]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("ul")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n      ")]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n    ")]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" FileUploader"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h2",{attrs:{id:"part-2-底层网络通信揭秘"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#part-2-底层网络通信揭秘"}},[t._v("#")]),t._v(" Part 2: 底层网络通信揭秘")]),t._v(" "),s("h3",{attrs:{id:"formdata-对象"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#formdata-对象"}},[t._v("#")]),t._v(" "),s("code",[t._v("FormData")]),t._v(" 对象")]),t._v(" "),s("p",[s("code",[t._v("FormData")]),t._v(" 是文件上传的核心。它允许我们构建一组键值对，模拟 HTML 表单的提交，特别适合用于发送二进制文件。浏览器会自动将其 "),s("code",[t._v("Content-Type")]),t._v(" 设置为 "),s("code",[t._v("multipart/form-data")]),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"网络请求库的选择-axios-vs-fetch-vs-xhr"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#网络请求库的选择-axios-vs-fetch-vs-xhr"}},[t._v("#")]),t._v(" 网络请求库的选择："),s("code",[t._v("Axios")]),t._v(" vs "),s("code",[t._v("Fetch")]),t._v(" vs "),s("code",[t._v("XHR")])]),t._v(" "),s("p",[t._v("在文件上传中，选择合适的网络库至关重要，尤其是当我们需要实现进度条等高级功能时。")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("Fetch API")]),t._v(": 现代、简洁，基于 Promise。但其原生设计中，获取上传进度（"),s("code",[t._v("upload.onprogress")]),t._v("）相对复杂，需要借助 "),s("code",[t._v("ReadableStream")]),t._v(" 来实现，兼容性稍差。")]),t._v(" "),s("li",[s("strong",[t._v("XMLHttpRequest (XHR)")]),t._v(": 传统但功能强大。"),s("code",[t._v("XHR")]),t._v(" 实例上有一个 "),s("code",[t._v("upload")]),t._v(" 对象，可以方便地监听 "),s("code",[t._v("progress")]),t._v(" 事件，是 "),s("code",[t._v("axios")]),t._v(" 等库实现上传进度的底层基础。")]),t._v(" "),s("li",[s("strong",[t._v("Axios")]),t._v(": 目前社区最优选。它基于 "),s("code",[t._v("XMLHttpRequest")]),t._v(" 封装，不仅保留了其强大功能（如进度监听），还提供了更友好的API（如拦截器、请求取消、自动JSON转换等），极大地简化了开发。")])]),t._v(" "),s("h3",{attrs:{id:"使用-axios-实现带进度的上传"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-axios-实现带进度的上传"}},[t._v("#")]),t._v(" 使用 Axios 实现带进度的上传")]),t._v(" "),s("p",[s("code",[t._v("axios")]),t._v(" 通过 "),s("code",[t._v("onUploadProgress")]),t._v(" 配置项，让我们能轻松地接入底层的 "),s("code",[t._v("progress")]),t._v(" 事件。")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" axios "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'axios'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("uploadWithAxios")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("file"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" onProgress")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" formData "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FormData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  formData"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'file'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" file"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" config "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onUploadProgress")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("progressEvent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" percentCompleted "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Math"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("round")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("progressEvent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loaded "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" progressEvent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("total"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onProgress")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("percentCompleted"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" axios"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("post")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/api/upload'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" formData"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用示例")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// uploadWithAxios(selectedFile, (percent) => {")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//   console.log(`Upload progress: ${percent}%`);")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//   // 更新你的React state或Vue data来驱动UI进度条")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// }).then(response => {")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//   console.log('Upload successful!', response.data);")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// }).catch(error => {")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//   console.error('Upload failed.', error);")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// });")]),t._v("\n")])])]),s("h3",{attrs:{id:"axios-核心知识点与常见问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#axios-核心知识点与常见问题"}},[t._v("#")]),t._v(" Axios 核心知识点与常见问题")]),t._v(" "),s("ol",[s("li",[s("p",[s("strong",[t._v("拦截器 (Interceptors)")]),t._v(":")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("请求拦截器")]),t._v(": 可以在请求发送前统一处理，如添加 "),s("code",[t._v("token")]),t._v(" 到请求头、序列化请求数据等。")]),t._v(" "),s("li",[s("strong",[t._v("响应拦截器")]),t._v(": 可以在接收到响应后统一处理，如处理全局错误码、反序列化数据等。")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("取消请求 (Cancellation)")]),t._v(":")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("axios")]),t._v(" 允许通过 "),s("code",[t._v("CancelToken")]),t._v(" (旧) 或 "),s("code",[t._v("AbortController")]),t._v(" (新) 来取消一个已发出的请求。这在用户手动取消上传或组件卸载时非常有用，可以避免不必要的网络流量和服务器处理。")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("全局配置与实例")]),t._v(":")]),t._v(" "),s("ul",[s("li",[t._v("可以创建一个 "),s("code",[t._v("axios")]),t._v(" 实例 ("),s("code",[t._v("axios.create()")]),t._v(") 并为其配置基础 URL ("),s("code",[t._v("baseURL")]),t._v(")、超时时间 ("),s("code",[t._v("timeout")]),t._v(") 等，避免在每个请求中重复编写。")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("常见问题："),s("code",[t._v("Content-Type")]),t._v(" 设置")]),t._v(":")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("陷阱")]),t._v(": 当使用 "),s("code",[t._v("axios")]),t._v(" 上传 "),s("code",[t._v("FormData")]),t._v(" 时，"),s("strong",[t._v("绝对不要")]),t._v("手动设置 "),s("code",[t._v("Content-Type")]),t._v(" 为 "),s("code",[t._v("multipart/form-data")]),t._v("。")]),t._v(" "),s("li",[s("strong",[t._v("原因")]),t._v(": 如果手动设置，"),s("code",[t._v("axios")]),t._v(" 会丢失 "),s("code",[t._v("boundary")]),t._v(" 字符串，这是 "),s("code",[t._v("multipart/form-data")]),t._v(" 格式中用于分隔不同字段的关键信息。")]),t._v(" "),s("li",[s("strong",[t._v("正确做法")]),t._v(": 完全不设置 "),s("code",[t._v("Content-Type")]),t._v("，浏览器会自动为 "),s("code",[t._v("FormData")]),t._v(" 对象添加正确的 "),s("code",[t._v("Content-Type")]),t._v("，包括 "),s("code",[t._v("boundary")]),t._v("。")])])])]),t._v(" "),s("h2",{attrs:{id:"part-3-高级策略-断点续传与分片上传"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#part-3-高级策略-断点续传与分片上传"}},[t._v("#")]),t._v(" Part 3: 高级策略：断点续传与分片上传")]),t._v(" "),s("p",[t._v("对于大文件（如视频、高清图集），一次性上传非常不可靠。网络波动、服务器超时都可能导致失败，且无法恢复。解决方案就是"),s("strong",[t._v("分片上传 (Chunking) + 断点续传 (Resumable)")]),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"核心思想"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#核心思想"}},[t._v("#")]),t._v(" 核心思想")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("分片 (Slicing)")]),t._v(": 在前端，使用 "),s("code",[t._v("File.prototype.slice()")]),t._v(" 方法将大文件切割成多个小数据块（chunks）。")]),t._v(" "),s("li",[s("strong",[t._v("逐片上传")]),t._v(": 按照顺序或并发地将这些切片上传到服务器。")]),t._v(" "),s("li",[s("strong",[t._v("服务端合并")]),t._v(": 服务器接收所有切片后，将它们按正确顺序合并成原始文件。")])]),t._v(" "),s("h3",{attrs:{id:"断点续传的实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#断点续传的实现"}},[t._v("#")]),t._v(" 断点续传的实现")]),t._v(" "),s("p",[t._v("断点续传是在分片上传基础上的增强。")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("生成文件唯一标识")]),t._v(": 在上传开始前，根据文件名、大小、最后修改时间等信息，为整个文件生成一个唯一的哈希值（如 "),s("code",[t._v("spark-md5")]),t._v("）。这个哈希是文件的“指纹”。")]),t._v(" "),s("li",[s("strong",[t._v("查询已上传切片")]),t._v(": 客户端每次上传前，携带文件哈希询问服务端：“这个文件已经上传了哪些切片？”")]),t._v(" "),s("li",[s("strong",[t._v("跳过已传切片")]),t._v(": 服务端根据哈希在数据库或缓存中查找记录，返回已上传的切片列表。")]),t._v(" "),s("li",[s("strong",[t._v("续传")]),t._v(": 客户端从第一个未上传的切片开始继续上传。")]),t._v(" "),s("li",[s("strong",[t._v("状态存储")]),t._v(": 客户端可以将上传进度（如文件哈希、已上传的切片索引）保存在 "),s("code",[t._v("localStorage")]),t._v(" 中，即使用户关闭浏览器再重新打开，也能恢复上传。")])]),t._v(" "),s("h2",{attrs:{id:"part-4-工业级标准-aws-s3-分段上传-multipart-upload"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#part-4-工业级标准-aws-s3-分段上传-multipart-upload"}},[t._v("#")]),t._v(" Part 4: 工业级标准：AWS S3 分段上传 (Multipart Upload)")]),t._v(" "),s("p",[t._v("Amazon S3 的分段上传是业界处理大文件上传的黄金标准，其原理与我们上面讨论的策略高度一致。")]),t._v(" "),s("h3",{attrs:{id:"s3-分段上传工作流"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#s3-分段上传工作流"}},[t._v("#")]),t._v(" S3 分段上传工作流")]),t._v(" "),s("ol",[s("li",[s("p",[s("strong",[t._v("Initiate Multipart Upload (初始化分段上传)")]),t._v(":")]),t._v(" "),s("ul",[s("li",[t._v("客户端向 S3 发送请求，声明要开始一个分段上传。")]),t._v(" "),s("li",[t._v("S3 返回一个全局唯一的 "),s("code",[t._v("UploadId")]),t._v("。这个 "),s("code",[t._v("UploadId")]),t._v(" 标识了本次上传会话。")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("Upload Part (上传分片)")]),t._v(":")]),t._v(" "),s("ul",[s("li",[t._v("客户端将文件分片，然后为每个分片调用 "),s("code",[t._v("Upload Part")]),t._v(" API。")]),t._v(" "),s("li",[t._v("请求中必须包含 "),s("code",[t._v("UploadId")]),t._v(" 和一个从 1 开始的 "),s("code",[t._v("PartNumber")]),t._v("（分片序号）。")]),t._v(" "),s("li",[t._v("每个分片上传成功后，S3 会返回一个 "),s("code",[t._v("ETag")]),t._v(" (实体标签)，这是该分片内容的 MD5 哈希，作为分片的唯一标识。")]),t._v(" "),s("li",[t._v("客户端必须记录下每个 "),s("code",[t._v("PartNumber")]),t._v(" 和其对应的 "),s("code",[t._v("ETag")]),t._v("。")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("Complete Multipart Upload (完成分段上传)")]),t._v(":")]),t._v(" "),s("ul",[s("li",[t._v("所有分片上传完毕后，客户端调用 "),s("code",[t._v("Complete Multipart Upload")]),t._v(" API。")]),t._v(" "),s("li",[t._v("请求中需包含 "),s("code",[t._v("UploadId")]),t._v(" 和一个XML/JSON列表，该列表包含了所有分片的 "),s("code",[t._v("PartNumber")]),t._v(" 和 "),s("code",[t._v("ETag")]),t._v("。")]),t._v(" "),s("li",[t._v("S3 收到请求后，会根据这个列表，按 "),s("code",[t._v("PartNumber")]),t._v(" 的顺序找到所有分片并合并它们，最终创建一个完整的对象。")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("Abort Multipart Upload (中止分段上传)")]),t._v(":")]),t._v(" "),s("ul",[s("li",[t._v("如果上传失败或被取消，客户端应调用此接口，S3 会删除所有已上传的分片，避免产生不必要的存储费用。")])])])]),t._v(" "),s("h3",{attrs:{id:"s3-协议的优势"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#s3-协议的优势"}},[t._v("#")]),t._v(" S3 协议的优势")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("高可靠性")]),t._v(": 任何一个分片上传失败，只需重传该分片即可。")]),t._v(" "),s("li",[s("strong",[t._v("高效率")]),t._v(": 多个分片可以并发上传，极大提升大文件的上传速度。")]),t._v(" "),s("li",[s("strong",[t._v("灵活性")]),t._v(": 无需预先知道文件总大小即可开始上传。")])]),t._v(" "),s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),s("p",[t._v("文件上传技术从简单的表单提交，演进到复杂的、高可用的分布式上传方案。作为前端工程师，理解其从UI设计到协议细节的全过程，不仅能帮助我们构建更优秀的应用，也是技术深度和广度的重要体现。尤其是在面试中，能够清晰地阐述大文件上传的挑战和解决方案，并结合S3等云服务标准进行讨论，无疑会成为一个重要的加分项。")])])}),[],!1,null,null,null);s.default=e.exports}}]);