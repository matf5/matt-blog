(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{307:function(t,s,a){"use strict";a.r(s);var n=a(14),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"浏览器ui渲染与事件循环的深入解析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#浏览器ui渲染与事件循环的深入解析"}},[t._v("#")]),t._v(" 浏览器UI渲染与事件循环的深入解析")]),t._v(" "),s("p",[t._v("这是一个非常深入的好问题！浏览器UI渲染和事件循环（Event Loop）的关系是理解前端性能的关键。")]),t._v(" "),s("p",[t._v("简单来说，答案是："),s("strong",[t._v("渲染（UI Rendering）是事件循环中的一个环节。因此，无论微任务（Microtask）还是宏任务（Macrotask）执行时间过长，都会阻塞渲染，导致页面卡顿或无响应。")])]),t._v(" "),s("p",[t._v("下面我们来详细拆解这个过程。")]),t._v(" "),s("h3",{attrs:{id:"_1-事件循环与渲染的关系"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-事件循环与渲染的关系"}},[t._v("#")]),t._v(" 1. 事件循环与渲染的关系")]),t._v(" "),s("p",[t._v("浏览器的事件循环模型可以概括为不断地从 "),s("strong",[t._v("宏任务队列（Macrotask Queue）")]),t._v(" 中取出一个任务执行。而在每个宏任务执行完毕后，会清空 "),s("strong",[t._v("微任务队列（Microtask Queue）")]),t._v("。")]),t._v(" "),s("p",[s("strong",[t._v("渲染")]),t._v("并不是每个循环都发生，而是由浏览器根据屏幕的刷新率（通常是60Hz，即约16.7ms一次）来决定何时更新视图。这个更新过程可以看作是事件循环中的一个特殊的、由浏览器控制的宏任务。")]),t._v(" "),s("p",[t._v("一个典型的事件循环“Tick”（单次循环）可以简化为以下步骤：")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("执行一个宏任务")]),t._v("：从宏任务队列中取出一个任务（例如 "),s("code",[t._v("script")]),t._v(" 标签内的代码、"),s("code",[t._v("setTimeout")]),t._v(" 回调、用户点击事件等）并执行。")]),t._v(" "),s("li",[s("strong",[t._v("执行所有微任务")]),t._v("：执行当前宏任务产生的所有微任务（例如 "),s("code",[t._v("Promise.then()")]),t._v("、"),s("code",[t._v("MutationObserver")]),t._v("），直到微任务队列为空。如果微任务执行过程中又产生了新的微任务，它们也会被加入队列并立即执行。")]),t._v(" "),s("li",[s("strong",[t._v("（可选）执行渲染")]),t._v("：在完成上述步骤后，浏览器有了一个“空闲”窗口。此时，它会判断是否需要进行UI渲染。这个判断基于以下几点：\n"),s("ul",[s("li",[t._v("是否有DOM变动、样式修改等导致需要 "),s("strong",[t._v("重排（Reflow）")]),t._v(" 或 "),s("strong",[t._v("重绘（Repaint）")]),t._v("。")]),t._v(" "),s("li",[t._v("是否到达了下一次 "),s("strong",[t._v("垂直同步（VSync）")]),t._v(" 的时间点（大约16.7ms）。")])])]),t._v(" "),s("li",[s("strong",[t._v("执行渲染流程")]),t._v("：如果需要渲染，浏览器会执行一系列步骤："),s("code",[t._v("Style")]),t._v(" -> "),s("code",[t._v("Layout")]),t._v(" -> "),s("code",[t._v("Paint")]),t._v(" -> "),s("code",[t._v("Composite")]),t._v("。")]),t._v(" "),s("li",[s("strong",[t._v("循环")]),t._v("：回到步骤1，准备执行下一个宏任务。")])]),t._v(" "),s("p",[t._v("这个流程可以用下面的图来表示：")]),t._v(" "),s("div",{staticClass:"language-mermaid extra-class"},[s("pre",{pre:!0,attrs:{class:"language-mermaid"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("graph")]),t._v(" TD\n    A"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[Event Loop Start]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v(" B"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("{Macrotask Queue}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    B "),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v(" C"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[Take one Macrotask]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    C "),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v(" D"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[Execute Macrotask]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    D "),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v(" E"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("{Microtask Queue}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    E "),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v(" F"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[Execute ALL Microtasks until empty]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    F "),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v(" G"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("{Render needed?}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    G "),s("span",{pre:!0,attrs:{class:"token inter-arrow-label"}},[s("span",{pre:!0,attrs:{class:"token arrow-head arrow operator"}},[t._v("--")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token label property"}},[t._v("Yes")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")])]),t._v(" H"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[Update Rendering]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    G "),s("span",{pre:!0,attrs:{class:"token inter-arrow-label"}},[s("span",{pre:!0,attrs:{class:"token arrow-head arrow operator"}},[t._v("--")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token label property"}},[t._v("No")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")])]),t._v(" I"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[Loop to next Macrotask]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    H "),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v(" I"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("subgraph")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Main Thread Execution"')]),t._v("\n        D\n        F\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("subgraph")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Browser Decision"')]),t._v("\n        G\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),s("h3",{attrs:{id:"_2-长时间任务如何影响渲染"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-长时间任务如何影响渲染"}},[t._v("#")]),t._v(" 2. 长时间任务如何影响渲染")]),t._v(" "),s("p",[s("strong",[t._v("主线程是单线程的")]),t._v("。这意味着JavaScript的执行、页面布局、绘制等工作都在同一个线程上完成。当其中任何一个任务长时间占用主线程时，其他所有任务都必须等待。")]),t._v(" "),s("h4",{attrs:{id:"a-长时间的宏任务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#a-长时间的宏任务"}},[t._v("#")]),t._v(" a. 长时间的宏任务")]),t._v(" "),s("p",[t._v("如果一个宏任务（如一个"),s("code",[t._v("setTimeout")]),t._v("回调或一个点击事件处理函数）内部有非常耗时的计算，它会阻塞后续所有任务，包括渲染。")]),t._v(" "),s("p",[s("strong",[t._v("示例：")])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'myButton'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'click'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Button clicked, starting heavy task...'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 模拟一个耗时2秒的计算")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" startTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Date"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Date"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" startTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Busy-waiting, blocking the main thread")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Heavy task finished.'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("当你点击按钮后：")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("click")]),t._v("事件作为宏任务被执行。")]),t._v(" "),s("li",[s("code",[t._v("while")]),t._v("循环开始，"),s("strong",[t._v("主线程被完全占用2秒")]),t._v("。")]),t._v(" "),s("li",[t._v("在这2秒内，浏览器无法响应任何其他用户输入（例如再次点击、悬停等）。")]),t._v(" "),s("li",[t._v("更重要的是，浏览器无法执行渲染步骤。即使你在点击后修改了DOM（例如 "),s("code",[t._v("button.textContent = 'Processing...'")]),t._v("），这个变化也无法被绘制到屏幕上，直到2秒后整个宏任务结束。")]),t._v(" "),s("li",[t._v("结果就是："),s("strong",[t._v("页面冻结2秒")]),t._v('，然后控制台输出 "Heavy task finished."。')])]),t._v(" "),s("h4",{attrs:{id:"b-长时间的微任务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#b-长时间的微任务"}},[t._v("#")]),t._v(" b. 长时间的微任务")]),t._v(" "),s("p",[t._v("长时间的微任务影响 "),s("strong",[t._v("更加严重")]),t._v("。因为在一个事件循环“tick”中，"),s("strong",[t._v("所有")]),t._v("微任务必须在渲染之前执行完毕。")]),t._v(" "),s("p",[s("strong",[t._v("示例：")])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Script start'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nPromise"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Microtask started, starting heavy task...'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 模拟一个耗时2秒的计算")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" startTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Date"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Date"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" startTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Busy-waiting, blocking the main thread")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Microtask finished.'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Macrotask (setTimeout) executed.'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("代码执行流程：")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("script")]),t._v(" 宏任务开始。"),s("code",[t._v("console.log('Script start')")]),t._v(" 执行。")]),t._v(" "),s("li",[s("code",[t._v("Promise.then()")]),t._v(" 的回调被放入微任务队列。")]),t._v(" "),s("li",[s("code",[t._v("setTimeout")]),t._v(" 的回调被放入宏任务队列。")]),t._v(" "),s("li",[s("code",[t._v("script")]),t._v(" 宏任务执行结束。")]),t._v(" "),s("li",[s("strong",[t._v("事件循环检查微任务队列")]),t._v("，发现 "),s("code",[t._v("Promise.then()")]),t._v(" 的回调。")]),t._v(" "),s("li",[t._v("开始执行微任务。"),s("code",[t._v("while")]),t._v(" 循环开始，"),s("strong",[t._v("主线程被完全占用2秒")]),t._v("。")]),t._v(" "),s("li",[t._v("在这2秒内，页面同样被冻结。")]),t._v(" "),s("li",[t._v("2秒后，微任务结束。")]),t._v(" "),s("li",[t._v("此时，"),s("strong",[t._v("不仅渲染被阻塞了，连下一个宏任务（"),s("code",[t._v("setTimeout")]),t._v("）也被阻塞了")]),t._v("。")]),t._v(" "),s("li",[t._v("微任务队列清空后，浏览器才有机会进行渲染，然后才会去宏任务队列中取出 "),s("code",[t._v("setTimeout")]),t._v(" 的回调来执行。")])]),t._v(" "),s("h3",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("关系")]),t._v("：UI渲染是事件循环的一个步骤，它发生在当前宏任务和所有微任务执行完毕之后。")]),t._v(" "),s("li",[s("strong",[t._v("影响")]),t._v("：\n"),s("ul",[s("li",[s("strong",[t._v("长时间的宏任务")]),t._v("会阻塞后续的渲染和其他所有任务，导致页面卡顿。")]),t._v(" "),s("li",[s("strong",[t._v("长时间的微任务")]),t._v("同样会阻塞渲染，且它的优先级更高，会先于下一个宏任务执行，因此它不仅阻塞渲染，还会阻塞后续所有的宏任务（如用户交互、"),s("code",[t._v("setTimeout")]),t._v("等）。")])])])]),t._v(" "),s("h3",{attrs:{id:"如何避免"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何避免"}},[t._v("#")]),t._v(" 如何避免？")]),t._v(" "),s("p",[t._v("为了保持页面流畅（理想情况是60fps，即每帧约16.7ms），任何单个任务（无论是宏任务还是微任务）都不应长时间占用主线程。")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("对于动画")]),t._v("：使用 "),s("code",[t._v("requestAnimationFrame")]),t._v("，它能保证你的代码在浏览器下一次重绘之前执行，是实现流畅动画的最佳选择。")]),t._v(" "),s("li",[s("strong",[t._v("对于长计算任务")]),t._v("：\n"),s("ul",[s("li",[t._v("将其放入 "),s("strong",[t._v("Web Worker")]),t._v(" 中，在后台线程执行，不阻塞主线程。")]),t._v(" "),s("li",[t._v("如果无法使用Worker，可以将大任务分解成许多小块，通过 "),s("code",[t._v("setTimeout(..., 0)")]),t._v(" 分散到事件循环的不同“tick”中执行。")])])])])])}),[],!1,null,null,null);s.default=e.exports}}]);